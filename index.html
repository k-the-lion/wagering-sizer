<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20-Minute Trader - Wagering Sizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-cell {
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        .header-cell {
            background-color: #f9fafb;
            font-weight: 600;
        }
        input[type="number"], select {
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        .lockout-red {
            color: #dc2626;
            font-weight: 700;
        }
        .profit-green {
            color: #16a34a;
        }
        .loss-red {
            color: #dc2626;
        }
        .disabled-row {
            background-color: #f3f4f6;
            opacity: 0.7;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-md p-6">
        <header class="mb-6 pb-4 border-b border-gray-200">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">20-Minute Trader â€” Wagering Sizer</h1>
            <div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-700">
                <h2 class="font-semibold mb-1">How to use this tool:</h2>
                <ol class="list-decimal list-inside space-y-1">
                    <li>Fill in your current day's account details and strategy in the setup boxes below.</li>
                    <li>Use the "NEXT TRADE SIZE" value for your upcoming trade.</li>
                    <li>After each trade, enter the final profit (positive) or loss (negative) in the "Actual Result ($)" column. The sizer will update automatically.</li>
                </ol>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <!-- Account Setup -->
            <div class="bg-gray-50 p-4 rounded-lg border">
                <h3 class="font-semibold text-lg mb-3">Account Setup</h3>
                <div class="space-y-3">
                    <div>
                        <label for="currentBalance" class="block text-sm font-medium text-gray-700">Current Balance ($)</label>
                        <input type="number" id="currentBalance" value="50000" class="mt-1">
                    </div>
                    <div>
                        <label for="maxLossLimit" class="block text-sm font-medium text-gray-700">Maximum Loss Limit ($)</label>
                        <input type="number" id="maxLossLimit" value="48000" class="mt-1">
                    </div>
                    <div>
                        <label for="lossLockoutPercent" class="block text-sm font-medium text-gray-700">Loss Lockout %</label>
                        <input type="number" id="lossLockoutPercent" value="0.125" step="0.001" class="mt-1">
                    </div>
                </div>
            </div>
            <!-- Ladder Logic -->
            <div class="bg-gray-50 p-4 rounded-lg border">
                <h3 class="font-semibold text-lg mb-3">Ladder Logic</h3>
                <div class="space-y-3">
                    <div>
                        <label for="autoLadder" class="block text-sm font-medium text-gray-700">Auto Ladder when Green?</label>
                        <select id="autoLadder" class="mt-1">
                            <option value="true" selected>On</option>
                            <option value="false">Off</option>
                        </select>
                    </div>
                    <div>
                        <label for="minProfitToKeep" class="block text-sm font-medium text-gray-700">Absolute minimum profit ($)</label>
                        <input type="number" id="minProfitToKeep" value="50" class="mt-1">
                    </div>
                    <div>
                        <label for="lockInPercent" class="block text-sm font-medium text-gray-700">Lock-in % of current green</label>
                        <input type="number" id="lockInPercent" value="0.75" step="0.01" class="mt-1">
                    </div>
                </div>
            </div>
            <!-- Sizing Parameters -->
            <div class="bg-gray-50 p-4 rounded-lg border">
                <h3 class="font-semibold text-lg mb-3">Sizing Parameters</h3>
                 <div class="space-y-3">
                    <div>
                        <label for="feeCushion" class="block text-sm font-medium text-gray-700">Per-trade fee cushion ($)</label>
                        <input type="number" id="feeCushion" value="5" class="mt-1">
                    </div>
                    <div>
                        <label for="roundDown" class="block text-sm font-medium text-gray-700">Round down to nearest $</label>
                        <input type="number" id="roundDown" value="5" step="1" class="mt-1">
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-4 rounded-lg border-2">
                <p class="text-sm font-medium text-gray-500">Full Stack ($)</p>
                <p id="fullStack" class="text-2xl font-bold"></p>
            </div>
            <div class="bg-white p-4 rounded-lg border-2">
                <p class="text-sm font-medium text-gray-500">Daily Loss Lockout ($)</p>
                <p id="dailyLossLockout" class="text-2xl font-bold"></p>
            </div>
            <div class="bg-blue-600 text-white p-4 rounded-lg shadow-lg">
                <p class="text-sm font-medium text-blue-200">NEXT TRADE SIZE ($)</p>
                <p id="nextTradeSize" class="text-2xl font-bold"></p>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 border">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="table-cell header-cell w-16">Trade #</th>
                        <th class="table-cell header-cell">Recommended TP/SL ($)</th>
                        <th class="table-cell header-cell bg-blue-100">Actual Result ($)</th>
                        <th class="table-cell header-cell">Running P&L ($)</th>
                        <th class="table-cell header-cell">Lockout</th>
                    </tr>
                </thead>
                <tbody id="trade-rows" class="bg-white divide-y divide-gray-200">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const NUM_TRADES = 50;

        function getFloatValue(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function getBoolValue(id) {
            return document.getElementById(id).value === 'true';
        }

        function calculate() {
            // Get all parameters
            const currentBalance = getFloatValue('currentBalance');
            const maxLossLimit = getFloatValue('maxLossLimit');
            const lossLockoutPercent = getFloatValue('lossLockoutPercent');
            const feeCushion = getFloatValue('feeCushion');
            const roundDown = getFloatValue('roundDown');
            const autoLadder = getBoolValue('autoLadder');
            const minProfitToKeep = getFloatValue('minProfitToKeep');
            const lockInPercent = getFloatValue('lockInPercent');

            // Initial calculations
            const fullStack = currentBalance - maxLossLimit;
            const dailyLossLockout = fullStack * lossLockoutPercent;
            
            document.getElementById('fullStack').textContent = fullStack.toFixed(2);
            document.getElementById('dailyLossLockout').textContent = `-${dailyLossLockout.toFixed(2)}`;

            let runningPL = 0;
            let isLockedOut = false;
            let nextTradeSizeFound = false;

            for (let i = 1; i <= NUM_TRADES; i++) {
                const row = document.getElementById(`trade-row-${i}`);
                const resultInput = document.getElementById(`result-${i}`);
                const recommendedTpslSpan = document.getElementById(`recommended-tpsl-${i}`);
                const runningPlSpan = document.getElementById(`running-pl-${i}`);
                const lockoutSpan = document.getElementById(`lockout-${i}`);

                const prevRunningPL = (i === 1) ? 0 : parseFloat(document.getElementById(`running-pl-${i - 1}`).textContent) || 0;

                let recommendedTpsl = 0;
                if (!isLockedOut) {
                    if (i === 1) {
                        recommendedTpsl = Math.floor(Math.max(0, (dailyLossLockout * 0.5) - feeCushion) / roundDown) * roundDown;
                    } else {
                        if (autoLadder && prevRunningPL > 0) {
                            const profitToRisk = prevRunningPL - Math.max(minProfitToKeep, prevRunningPL * lockInPercent);
                            recommendedTpsl = Math.floor(Math.max(0, profitToRisk - feeCushion) / roundDown) * roundDown;
                        } else {
                            recommendedTpsl = Math.floor(Math.max(0, ((dailyLossLockout + prevRunningPL) * 0.5) - feeCushion) / roundDown) * roundDown;
                        }
                    }
                }
                recommendedTpslSpan.textContent = recommendedTpsl.toFixed(2);
                
                // Update next trade size display only for the first open trade
                if (!isLockedOut && !nextTradeSizeFound) {
                    document.getElementById('nextTradeSize').textContent = recommendedTpsl.toFixed(2);
                    if (resultInput.value.trim() !== '') {
                        // This trade is filled, so the next one is the 'next trade'
                    } else {
                       nextTradeSizeFound = true; 
                    }
                }

                // Calculate running P&L based on actual result
                const actualResult = parseFloat(resultInput.value) || 0;
                runningPL = prevRunningPL + actualResult;

                runningPlSpan.textContent = runningPL.toFixed(2);
                runningPlSpan.classList.toggle('profit-green', runningPL > 0);
                runningPlSpan.classList.toggle('loss-red', runningPL < 0);

                // Check for lockout conditions
                let lockoutMsg = "";
                if (runningPL <= -dailyLossLockout && dailyLossLockout > 0) {
                    lockoutMsg = "LOCKOUT (Daily Loss)";
                    isLockedOut = true;
                } else if (autoLadder && prevRunningPL > 0 && actualResult < 0) {
                    lockoutMsg = "LOCKOUT (Ladder Loss)";
                    isLockedOut = true;
                }
                lockoutSpan.textContent = lockoutMsg;
                lockoutSpan.classList.add('lockout-red');

                // Disable future rows if locked out or current row is active
                const isRowActive = resultInput.value.trim() !== '';

                if (isLockedOut) {
                    for (let j = i + 1; j <= NUM_TRADES; j++) {
                        document.getElementById(`trade-row-${j}`).classList.add('disabled-row');
                        document.getElementById(`result-${j}`).disabled = true;
                    }
                }
            }
            
            if (isLockedOut) {
                document.getElementById('nextTradeSize').textContent = "LOCKED OUT";
                document.getElementById('nextTradeSize').parentElement.classList.add('bg-red-600');
                document.getElementById('nextTradeSize').parentElement.classList.remove('bg-blue-600');
            } else {
                document.getElementById('nextTradeSize').parentElement.classList.remove('bg-red-600');
                document.getElementById('nextTradeSize').parentElement.classList.add('bg-blue-600');
                 // If loop finishes without finding an empty slot and not locked out, it must be the last one
                if (!nextTradeSizeFound) {
                   const lastRunningPL = parseFloat(document.getElementById(`running-pl-${NUM_TRADES}`).textContent) || 0;
                   let finalTradeSize = 0;
                    if (autoLadder && lastRunningPL > 0) {
                        const profitToRisk = lastRunningPL - Math.max(minProfitToKeep, lastRunningPL * lockInPercent);
                        finalTradeSize = Math.floor(Math.max(0, profitToRisk - feeCushion) / roundDown) * roundDown;
                    } else {
                        finalTradeSize = Math.floor(Math.max(0, ((dailyLossLockout + lastRunningPL) * 0.5) - feeCushion) / roundDown) * roundDown;
                    }
                   document.getElementById('nextTradeSize').textContent = finalTradeSize.toFixed(2);
                }
            }
        }

        function createTradeRows() {
            const tbody = document.getElementById('trade-rows');
            for (let i = 1; i <= NUM_TRADES; i++) {
                const row = document.createElement('tr');
                row.id = `trade-row-${i}`;
                row.innerHTML = `
                    <td class="table-cell font-medium">${i}</td>
                    <td class="table-cell font-mono"><span id="recommended-tpsl-${i}">0.00</span></td>
                    <td class="table-cell bg-blue-50">
                        <input type="number" id="result-${i}" class="result-input font-mono" placeholder="0.00" step="0.01" data-trade-id="${i}">
                    </td>
                    <td class="table-cell font-mono font-semibold"><span id="running-pl-${i}">0.00</span></td>
                    <td class="table-cell"><span id="lockout-${i}"></span></td>
                `;
                tbody.appendChild(row);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            createTradeRows();
            
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => input.addEventListener('input', calculate));
            
            calculate(); // Initial calculation
        });
    </script>
</body>
</html>
